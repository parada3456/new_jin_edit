<!DOCTYPE html>
<html lang="en">

<head>
    <title>ReadingPage</title>
    <!-- Include your CSS and other meta tags here -->
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/static/read_style.css">
    <link rel="stylesheet" type="text/css" href="/static/header_footer.css">
    <link rel="stylesheet" type="text/css" href="/static/bookstyle.css">
    <link rel="stylesheet" type="text/css" href="../static/main_style.css">
    <link rel="stylesheet" type="text/css" href="../static/drop_down.css">


    <!--fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@100;200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    
    
</head>

<body>
    <div id="reading"></div>

    <section id="searchBar">
        <div id="dark_overlay" onclick="toggle_search_off()"></div>
        <div  id="search_header">
            <div class="search_item">
                <form id="searchForm">
                    <input id="search_str" name="search_str" type="text" class="search_input" placeholder="ค้นหา" required>
                    <a href="#" onclick="toggle_search_off(), replace_dd_info()"> <img class="close_search" src="../assets/header_img/close_search.png" alt=Original Image"></a>
                </form>
            </div>
        </div>
    </section>

    <!--หัวกระดาษ-->
    <div class="header_flexbox_menu" style=" background-color: white; border-color: white;">
        <div class="header_menu_item" style="background-color: white; text-align: left; padding-left: 10%;">
            <a href="book_Info.html" class="header_writing_type" style="color: rgb(0, 203, 195);" href="#"></a> 
            <a onclick="back_to_book_info()"><img src="../assets/book_img/home_button.png" class="home_icon"
                    style="vertical-align: bottom;"></a>
            <div class="header_box_text">
                <a id="chapter_number_header" class="header_chapter_text"></a>
                <a id="chapter_name_header" class="header_chapter_text"></a>
            </div>
        </div>
        <div class="header_menu_item" style="background-color: white;">
            <a href="homepage.html"><img src="../assets/writearead_img/WriteARead.png" class="WriteARead_image"></a>
        </div>
        <div class="header_menu_item" style="background-color: white;">
            <a href="#" onclick="toggle_search()"> <img class="search_icon" src="../assets/header_img/search_button.png" alt="Original Image"></a>
            <a href="#" onclick="go_to_my_writing()"> <img class="pen_icon" src="../assets/header_img/writing_button.png" alt="Original Image"></a>
            <a href="#" onclick="toggle_user_icon_drop_down(), replace_dd_info()"> <img class="user_icon" id="header_profile_pic" src="../assets/header_img/user_button_light.png" alt="Original Image" onerror="this.onerror=null;this.src='../assets/header_img/user_button_light.png';"></a>
        </div>
    </div>

    <section id="home_dd_container">
        <div>
            <div class="dd_profile_container home_dd_cursor_coin" onclick="go_to_my_page()">
                <div>
                    <img class="dd_profile_pic" id="dd_profile_pic" src="../assets/header_img/user_button_light.png">
                </div>
                <div>
                    <a class="dd_display_name" id="dd_display_name">{display_name}</a> <br>
                    <a class="dd_user_name" id="dd_username">{username}</a>
                </div>
            </div>
            <hr class="dd_lines">
            <div class="dd_item space dd_cursor_coin">
                <div style="margin-left: 15px;">
                    <div class="coin_color" id="dd_golden_coin"><img class="dd_coin_pic" src="../assets/writearead_img/golden_coin.png">{golden_coin}</div>
                    <div style="color: var(--gray);" id="dd_silver_coin"><img class="dd_coin_pic" src="../assets/writearead_img/silver_coin.png">{silver_coin}</div>
                    <div id="dd_total_coin">รวม {total_coin} คอยน์์</div>
                </div>
                <div>
                    <a onclick="go_to_buy_coin()" class="dd_top_up_btn">+</a>
                </div>
            </div>
            <hr class="dd_lines">
            <div class="dd_item">
                <div onclick="go_to_my_writing()" class="dd_menu"><img class="dd_icon_pic" src="../assets/writearead_img/my_writing.png">My Writing</div>
                <div onclick="go_to_my_page()" class="dd_menu"><img class="dd_icon_pic" src="../assets/writearead_img/my_page.png">My Page</div>
                <div onclick="go_to_my_profile()" class="dd_menu"><img class="dd_icon_pic" src="../assets/writearead_img/my_profile.png">My Profile</div>
            </div>
            <hr class="dd_lines">
            <div class="dd_item">
                <div onclick="go_to_transac()" class="dd_menu"><img class="dd_icon_pic" src="../assets/writearead_img/transaction.png">ประวัติการสั่งซื้อ</div>
            </div>
            <hr class="dd_lines">
            <div class="dd_item">
                <div onclick="go_to_sign_in()" class="dd_menu"><img class="dd_icon_pic" src="../assets/writearead_img/sign_out.png">ออกจากระบบ</div>
            </div>
        </div>
    </section>

    <!-- reading header-->
    <div class="flexbox-3">
        <div class="item-3">
            <div class="info_text"
                style="font-size: 14px; color: rgb(106, 106, 106); text-align: center; margin-bottom: 20px;">
                <a id='book_name'></a>
            </div>
            <div class="info_text" style="font-size: 30px; color: rgb(29, 29, 29); text-align: center;">
                <a>บทที่</a>
                <a id="chapter_number"></a>
                <a id="chapter_name"></a>

            </div>
        </div>
        <div class="context_text item-3" style="margin-top: 0; padding-left: 7%; padding-right: 7%;">
            <a id="chapter_context"></a>
        </div>
        <div class="context_text item-3" style="margin-top: 1px; padding-left: 7%; padding-right: 7%; ">
            <a>Lastest edit : </a>
            <a id="chapter_date_time"></a>
        </div>
    </div>



    <!-- add comment -->
    <div class="flexbox-3">
        <div class="item-3">
            <div class="search_item">
                <form id="commentForm">
                    <input type="hidden" name="chapter_id">
                    <input type="hidden" name ="username">


                    <h1 class="info_title">Your Comment : </h1>
                    <textarea id="context" class="input_box" name="context" style="width: 40%;" rows="4" cols="50"
                        placeholder="context" required></textarea><br><br>


                    <button type="submit" class="submit_button">Submit</button>
                </form>
            </div>
        </div>
    </div>


    <!-- show comment -->
    <div id="commentsContainer"></div>


    <footer class="footer">
        <a class="footer_home_button" href="https://www.readawrite.com/">ReadAWrite</a>
        <a class="footer_menu_text" href="../Templates/my_page.html">My Page</a><br>
        <a class="footer_menu_text" href="../Templates/my_profile.html">My Profile</a><br>
        <a class="footer_menu_text" href="../Templates/payment.html">Buy coin</a><br>
        <a class="footer_menu_text" href="../Templates/transaction.html">Transaction</a><br>
        <p class="footer_menu_text">© 2024 - 2024 Teletubbies Book Center | All Rights Reserved.</p>
</footer>
    <br>
    <script>
        var header_profile_pic = document.getElementById('header_profile_pic');
        header_profile_pic.src = `../assets/profile_img/${localStorage.getItem('login_username')}.png`;
    </script>
    

    <script>
        var book_name = localStorage.getItem('book_name_last');
        document.getElementById("book_name").innerHTML = book_name;
        // Retrieve book information from sessionStorage
        const chapterInfoString = sessionStorage.getItem('chapterInfo');
        console.log("chapterInfoString", chapterInfoString);

        if (chapterInfoString) {
            try {
                const chapterInfo = JSON.parse(chapterInfoString);
                console.log("chapterInfo", chapterInfo);

                if (chapterInfo) {
                    const { chapter_number, chapter_id, name, context, date_time } = chapterInfo;

                    // Display book information in the HTML page
                    document.getElementById('chapter_number').textContent = chapter_number || '';
                    document.getElementById('chapter_number_header').textContent = chapter_number || '';
                    document.getElementById('chapter_name').textContent = name || '';
                    document.getElementById('chapter_name_header').textContent = name || '';
                    document.getElementById('chapter_context').textContent = context || '';
                    document.getElementById('chapter_date_time').textContent = date_time || '';

                    // Retrieve the comment data from sessionStorage
                    const commentDataUse = JSON.parse(sessionStorage.getItem('commentData'));
                    const commentsContainer = document.getElementById('commentsContainer');
                    commentsContainer.innerHTML = ''; // Clear existing comments
                    console.log(commentsContainer);

                    // Check if commentDataUse is not null and is an array
                    if (commentDataUse && Array.isArray(commentDataUse)) {
                        // Iterate over each comment data and create HTML elements
                        commentDataUse.forEach(commentData => {
                            console.log("commentData", commentData);
                            commentsContainer.innerHTML += `
                            <div class="flexbox-3">
                                <div class="item-3">
                                    <div class="comment-context-text">${commentData.context}</div>
                                    <div class="comment-info-flexbox">
                                        <div class="comment-username-text" style="text-align: left; width:100%;">
                                            <a class="comment-username-text">${commentData.chapter}</a>
                                        </div>
                                        <div class="comment-username-text" style="text-align: right; width:100%;">
                                            <a href="report_page.html"> <img class="home_icon" style="text-align: right;" src="../assets/book_img/report_icon.png" alt="Original Image"></a>
                                            <br>
                                            <a class="comment-username-text">${commentData.user}</a>
                                            <br>
                                            <a class="comment-date-text">${commentData.date_time}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            `;
                        });
                    } else {
                        console.error('commentDataUse is null or not an array.');
                    }

                    // Call the showChapter and showComment functions when the window loads
                    window.onload = function () {
                        showComment(chapterInfo.chapter_id);
                    };
                } else {
                    console.error('chapterInfo object is null or undefined.');
                }
            } catch (error) {
                console.error('Error parsing chapterInfo JSON:', error);
            }
        } else {
            console.error('chapterInfoString is null or undefined.');
        }
    </script>
        <script src="../scripts/book_info.js"></script>
        <script src="../scripts/reading_chapter.js"></script>
        <script src="../scripts/search_bar.js"></script>
        <script src="../scripts/change_page.js"></script>
        <script src="../scripts/dropdown_info.js"></script>
</body>

</html>